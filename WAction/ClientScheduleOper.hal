external function LongInt DateTimeDiff(date,time,date,time);remote updating procedure RemoveEmptyIVCash(array LongInt,string);global //Edit***************************Sasha2,11:36 05.12.2016 {updating procedure LookUpAndRemoveEmptyIVCash(date curdate,time curtime,LongInt minMinutesForHiding)begin  array LongInt IVCashNrsToDelete;  record IVCashVc IVCashr;  boolean TrHs,testf;  integer oldprogmode;        oldprogmode = CompanyProgramMode;    IVCashr.OKFlag = 0;    TrHs = true;    while (LoopKey("OKFlag",IVCashr,1,TrHs)) begin      testf = true;      if (IVCashr.OKFlag!=0) then begin TrHs = false; testf = false; end;      if (MatRowCnt(IVCashr)>0) then begin testf = false; end;      if (DateTimeDiff(curdate,curtime,IVCashr.TransDate,IVCashr.TransTime)<minMinutesForHiding) then begin testf = false; end;      if (testf) then begin        IVCashNrsToDelete[IVCashNrsToDelete.length] = IVCashr.SerNr;      end;    end;        if (SetCompanyProgramMode(kProgramModeClient)) then begin      if (IVCashNrsToDelete.length>0) then begin        asyncremote.RemoveEmptyIVCash(IVCashNrsToDelete,CurMachineName);      end;      SetCompanyProgramMode(oldprogmode);    end; return;end;  //Edit***************************Sasha2,11:36 05.12.2016 }global //Edit***************************Sasha2,11:36 05.12.2016 {updating procedure RemoveEmptyIVCashCallback(array LongInt IVCashNrsToDelete)begin  Integer i,cnt;  record IVCashVc IVCashr;      cnt = IVCashNrsToDelete.length;    if (cnt>0) then begin      for (i=0;i<cnt;i=i+1) begin        IVCashr.SerNr = IVCashNrsToDelete[i];        if (ReadFirstMain(IVCashr,1,true)) then begin          RecordDelete(IVCashr);        end;      end;    end;    return;end; //Edit***************************Sasha2,11:36 05.12.2016 }globalupdating procedure HideOldIVCash(date curdate,time curtime,LongInt minMinutesForHiding)begin  record IVCashVc IVCashr,IVCash2r;  Boolean TrHs,testf;  Integer emptySalesManCnt;        IVCash2r.SerNr = 999999999;    ReadLastMain(IVCash2r,1,false);        IVCashr.TransDate = curdate;    TrHs = true;    while (LoopBackKey("TransDate",IVCashr,1,TrHs)) begin      testf = true;      if (Blank(IVCashr.SalesMan)) then begin        testf = false;         emptySalesManCnt = emptySalesManCnt + 1;       end;      if (emptySalesManCnt==100) then begin TrHs = false; testf = false; end;      if (DateTimeDiff(curdate,curtime,IVCashr.TransDate,IVCashr.TransTime)<minMinutesForHiding) then begin testf = false; end;      if (IVCashr.OKFlag==0) then begin        if (MatRowCnt(IVCashr)>0) then begin          testf = false;         end;        if (IVCash2r.SerNr>-1 and IVCash2r.SerNr==IVCashr.SerNr) then begin          testf = false;         end;      end;      if (testf) then begin        IVCashr.InvComment = IVCashr.InvComment & " SalesMan:" & IVCashr.SalesMan & ".HDSCH";        IVCashr.SalesMan = "";        RECORDSTORE(IVCashr,true);      end;    end;  return;end;globalupdating procedure ClientScheduleOprtns()begin  date curdate;  time curtime;  LongInt minMinutesForHiding;      LogText(0,"ClientScheduleOprtns run");        curdate = CurrentDate;    curtime = CurrentTime;    minMinutesForHiding = 120; //minutes    HideOldIVCash(curdate,curtime,minMinutesForHiding);    LookUpAndRemoveEmptyIVCash(curdate,curtime,minMinutesForHiding);  return;end;